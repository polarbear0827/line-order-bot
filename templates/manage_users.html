<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½¿ç”¨è€…ç®¡ç†</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header-bar">
            <h1>ğŸ‘¥ ä½¿ç”¨è€…ç®¡ç†</h1>
            <div class="user-info">
                <span>ğŸ‘¤ {{ user.name }}</span>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="{{ url_for('dashboard') }}" class="btn">è¿”å›é¦–é </a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="section">
            <h2>â• æ–°å¢ä½¿ç”¨è€…</h2>
            <form action="{{ url_for('add_user') }}" method="post" class="user-form">
                <input type="text" name="user_code" placeholder="ä»£è™Ÿï¼ˆä¾‹å¦‚ï¼š2ï¼‰" required>
                <input type="text" name="name" placeholder="å§“å" required>
                <button type="submit" class="btn btn-success">æ–°å¢</button>
            </form>
            <p class="hint">ğŸ’¡ ä»£è™Ÿç”¨æ–¼ LINE Bot é»é¤è­˜åˆ¥ï¼Œå»ºè­°ä½¿ç”¨æ•¸å­—</p>
        </div>

        <div class="section">
            <h2>ğŸ“‹ ä½¿ç”¨è€…åˆ—è¡¨ï¼ˆå…± {{ users|length }} äººï¼‰</h2>
            {% if users %}
            <div class="users-table">
                <table>
                    <thead>
                        <tr>
                            <th>ä»£è™Ÿ</th>
                            <th>å§“å</th>
                            <th>å»ºç«‹æ™‚é–“</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td><strong>{{ u.user_code }}</strong></td>
                            <td>{{ u.name }}</td>
                            <td>{{ u.created_date.strftime('%Y/%m/%d') }}</td>
                            <td class="actions">
                                <button onclick="editUser({{ u.id }}, '{{ u.user_code }}', '{{ u.name }}')"
                                        class="btn btn-small btn-warning">ç·¨è¼¯</button>
                                <form action="{{ url_for('delete_user', user_id=u.id) }}"
                                      method="post"
                                      style="display:inline;"
                                      onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤ {{ u.name }} å—ï¼Ÿé€™å°‡åŒæ™‚åˆªé™¤æ‰€æœ‰ç›¸é—œè¨‚å–®ï¼');">
                                    <button type="submit" class="btn btn-small btn-danger">åˆªé™¤</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="no-data">é‚„æ²’æœ‰ä½¿ç”¨è€…ï¼Œè«‹å…ˆæ–°å¢</p>
            {% endif %}
        </div>
    </div>

    <!-- ç·¨è¼¯ä½¿ç”¨è€…å°è©±æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>ç·¨è¼¯ä½¿ç”¨è€…</h3>
            <form id="editForm" method="post">
                <div class="form-group">
                    <label>ä»£è™Ÿï¼š</label>
                    <input type="text" id="edit_code" name="user_code" required>
                </div>
                <div class="form-group">
                    <label>å§“åï¼š</label>
                    <input type="text" id="edit_name" name="name" required>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn btn-primary">å„²å­˜</button>
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function editUser(id, code, name) {
            document.getElementById('editForm').action = '/users/edit/' + id;
            document.getElementById('edit_code').value = code;
            document.getElementById('edit_name').value = name;
            document.getElementById('editModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>